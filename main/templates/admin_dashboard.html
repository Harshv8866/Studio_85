<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Admin Dashboard | Studio_85</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #3B3030;
      color: #FFF0D1;
      padding-top: 60px;
      display: flex;
    }
    .topbar {
      position: fixed; top: 0; left: 0; right: 0; height: 60px;
      background-color: #664343;
      display: flex; justify-content: space-between; align-items: center;
      padding: 0 30px; z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    .topbar .logo { font-size: 24px; font-weight: bold; color: #FFF0D1; }
    .topbar .logout-btn {
      background-color: #795757; color: #FFF0D1;
      padding: 8px 16px; border: none; cursor: pointer;
      font-weight: bold; border-radius: 4px;
    }
    .topbar .logout-btn:hover { background-color: #a06666; }

    .sidebar {
      width: 220px; background-color: #5C3F3F;
      padding-top: 20px; position: fixed; top: 60px; bottom: 0; left: 0;
    }
    .sidebar a {
      display: block; padding: 15px 20px; color: #FFF0D1;
      text-decoration: none; border-bottom: 1px solid #795757;
      transition: background 0.3s;
    }
    .sidebar a:hover { background-color: #795757; }

    .content { margin-left: 220px; padding: 30px; flex: 1; }

    .section { display: none; }
    .section.active { display: block; }

    form input, form textarea, form select {
      padding: 8px; margin-bottom: 15px; width: 100%;
      background: #FFF0D1; color: #3B3030; border: none;
    }
    .form-group {
  max-width: 500px;
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: bold;
}

.form-group select,
.form-group input[type="file"] {
  width: 100%;
  padding: 8px;
  background-color: #fcecc4;
  border: none;
  color: #3B3030;
}

    form button {
      padding: 8px 16px; background: #795757;
      color: white; border: none; cursor: pointer;
    }
    form button:hover { background: #a06666; }

    .media-group {
  margin-bottom: 30px;
}

.media-title {
  margin: 20px 0 10px;
  font-size: 18px;
  color: #ffe4b5;
  border-bottom: 1px solid #795757;
  padding-bottom: 5px;
}

.media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 20px;
  margin-top: 10px;
}

.media-item {
  position: relative;
  border: 2px solid #FFF0D1;
  border-radius: 10px;
  overflow: hidden;
  background-color: #4a3b3b;
  transition: transform 0.2s ease;
}

.media-item:hover {
  transform: scale(1.03);
}

.media-item img,
.media-item video {
  width: 100%;
  height: 130px;
  object-fit: cover;
  border-radius: 8px;
}

.media-item form {
  position: absolute;
  top: 5px;
  right: 5px;
}

.media-item button {
  background: #FFF;
  color: #260707;
  border: none;
  padding: 4px 7px;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  font-weight: bold;
}
.menu-toggle {
  display: none;
  background: none;
  border: none;
  font-size: 24px;
  color: #FFF0D1;
  cursor: pointer;
}

@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: -220px;
    transition: left 0.3s ease;
    z-index: 999;
  }

  .sidebar.open {
    left: 0;
  }

  .content {
    margin-left: 0;
  }

  .menu-toggle {
    display: block;
  }
}


  </style>
  
</head>
<body>
{% load static %}
  <!-- Top Navbar -->
<div class="topbar">
  <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
  <div class="logo"><img src="{% static 'main/images/logo.png' %}" style="height: 50px;" alt=""></div>
  <form method="POST" action="{% url 'admin_logout' %}">
    {% csrf_token %}
    <button type="submit" class="logout-btn">Logout</button>
  </form>
</div>


  <!-- Sidebar -->
  <div class="sidebar">
    <a href="?section=category">Category</a>
    <a href="?section=media">Images / Video</a>
    <a href="?section=contact">Contact Detail</a>
  </div>

  <!-- Main Content -->
  <div class="content">

    <!-- Category Section -->
    <div id="category" class="section">
      <h3>Manage Categories</h3>
      {% for service in services %}
        <div style="margin-bottom: 10px;">
          <form method="POST" action="{% url 'rename_service' service.id %}" style="display: inline;">
            {% csrf_token %}
            <input type="text" name="new_name" value="{{ service.name }}" style="width: 250px;">
            <button type="submit">Rename</button>
          </form>
        </div>
      {% endfor %}
    </div>

    <!-- Media Section -->
    <div id="media" class="section">
      <h3>Upload Images / Videos</h3>
<form method="POST" enctype="multipart/form-data" action="{% url 'upload_media' %}">
  {% csrf_token %}

  <div class="form-group">
    <label>Select Service:</label>
    <select name="service_id" required>
      {% for service in services %}
        <option value="{{ service.id }}">{{ service.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="form-group">
    <label>Choose File(s):</label>
    <input type="file" name="media_file" multiple required>
  </div>

  <button type="submit mb-3 fw-bold">Upload</button>
</form>


      <hr>
      <h4>Uploaded Media</h4>
{% for service in services %}
  <div class="media-group">
    <h5>{{ service.name|title }}</h5>

    <!-- Images -->
    <div>
      <div class="media-title">Images:</div>
      <div class="media-grid">
        {% for media in service.media.all %}
          {% with media.media_file.url|lower as url %}
            {% if not url|slice:"-4:" == ".mp4" and not url|slice:"-5:" == ".webm" and not url|slice:"-4:" == ".mov" %}
              <div class="media-item">
                <img src="{{ media.media_file.url }}" alt="Image">
                <form method="POST" action="{% url 'delete_media' media.id %}?section=media">
                  {% csrf_token %}
                  <button type="submit">X</button>
                </form>
              </div>
            {% endif %}
          {% endwith %}
        {% empty %}
          <p style="color: gray;">No images yet.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Videos -->
    <div>
      <div class="media-title">Videos:</div>
      <div class="media-grid">
        {% for media in service.media.all %}
          {% with media.media_file.url|lower as url %}
            {% if url|slice:"-4:" == ".mp4" or url|slice:"-5:" == ".webm" or url|slice:"-4:" == ".mov" %}
              <div class="media-item">
                <video controls>
                  <source src="{{ media.media_file.url }}">
                  Your browser does not support the video tag.
                </video>
                <form method="POST" action="{% url 'delete_media' media.id %}?section=media">
                  {% csrf_token %}
                  <button type="submit">X</button>
                </form>
              </div>
            {% endif %}
          {% endwith %}
        {% empty %}
          <p style="color: gray;">No videos yet.</p>
        {% endfor %}
      </div>
    </div>
  </div>
{% endfor %}


    </div>

    <!-- Contact Section -->
    <div id="contact" class="section">
      <h3>Contact Details</h3>
      <form method="POST" action="{% url 'update_contact' %}">
        {% csrf_token %}
        <label>Phone Number:</label>
        <input type="text" name="phone" value="{{ contact.phone|default:'' }}">
        <label>Email:</label>
        <input type="email" name="email" value="{{ contact.email|default:'' }}">
        <label>Address:</label>
        <textarea name="address">{{ contact.address|default:'' }}</textarea>
        <button type="submit">Save</button>
      </form>
    </div>

  </div>

  <!-- Section Toggle Script -->
  <script>
    function showSection(id) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      const sectionElement = document.getElementById(id);
      if (sectionElement) {
        sectionElement.classList.add('active');
      }
    }

    window.onload = function () {
      const params = new URLSearchParams(window.location.search);
      const section = params.get('section') || 'category';
      showSection(section);
    };
  </script>

  <!-- AJAX Delete Media Script -->
  <script>
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    function deleteMedia(mediaId) {
      if (!confirm("Are you sure you want to delete this media?")) return;

      fetch(`/delete-media/${mediaId}/`, {
        method: "POST",
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
        }
      })
      .then(response => {
        if (response.ok) {
          document.getElementById(`media-${mediaId}`).remove();
        } else {
          alert("Failed to delete media.");
        }
      });
    }
  </script>
  <script>
  function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    sidebar.classList.toggle('open');
  }
</script>


</body>
</html>
